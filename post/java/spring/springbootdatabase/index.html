<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>SpringBoot数据库相关 - Mythos · Java Developer</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Kuangcp" /><meta name="description" content="💠 数据库模块 1.1. 多数据源配置 1.2. 连接池 1.2.1. c3p0 1.2.2. druid 1.2.3. HikariCP 1.3. Relational Database 1.3.1. JPA 1.3.1.1. Configuration 1.3.1.2. Jpa数据分页 1.3.1.3. 原生SQL 1.3.1.4. Mysql 1.3.1.5. 映射关系 1.3.1.5.1. 一对一 1.3.1.5.2. 一对多 1.3.1.5.3. 多对多 1.3.2. Mybatis 1.4. Non Relational database 1.4.1." /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.99.0 with theme even" />


<link rel="canonical" href="https://www.kuangcp.top/post/java/spring/springbootdatabase/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="SpringBoot数据库相关" />
<meta property="og:description" content="💠 数据库模块 1.1. 多数据源配置 1.2. 连接池 1.2.1. c3p0 1.2.2. druid 1.2.3. HikariCP 1.3. Relational Database 1.3.1. JPA 1.3.1.1. Configuration 1.3.1.2. Jpa数据分页 1.3.1.3. 原生SQL 1.3.1.4. Mysql 1.3.1.5. 映射关系 1.3.1.5.1. 一对一 1.3.1.5.2. 一对多 1.3.1.5.3. 多对多 1.3.2. Mybatis 1.4. Non Relational database 1.4.1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.kuangcp.top/post/java/spring/springbootdatabase/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2018-12-21T10:50:38+00:00" />
<meta property="article:modified_time" content="2018-12-21T10:50:38+00:00" />

<meta itemprop="name" content="SpringBoot数据库相关">
<meta itemprop="description" content="💠 数据库模块 1.1. 多数据源配置 1.2. 连接池 1.2.1. c3p0 1.2.2. druid 1.2.3. HikariCP 1.3. Relational Database 1.3.1. JPA 1.3.1.1. Configuration 1.3.1.2. Jpa数据分页 1.3.1.3. 原生SQL 1.3.1.4. Mysql 1.3.1.5. 映射关系 1.3.1.5.1. 一对一 1.3.1.5.2. 一对多 1.3.1.5.3. 多对多 1.3.2. Mybatis 1.4. Non Relational database 1.4.1."><meta itemprop="datePublished" content="2018-12-21T10:50:38+00:00" />
<meta itemprop="dateModified" content="2018-12-21T10:50:38+00:00" />
<meta itemprop="wordCount" content="2442">
<meta itemprop="keywords" content="SpringBoot," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SpringBoot数据库相关"/>
<meta name="twitter:description" content="💠 数据库模块 1.1. 多数据源配置 1.2. 连接池 1.2.1. c3p0 1.2.2. druid 1.2.3. HikariCP 1.3. Relational Database 1.3.1. JPA 1.3.1.1. Configuration 1.3.1.2. Jpa数据分页 1.3.1.3. 原生SQL 1.3.1.4. Mysql 1.3.1.5. 映射关系 1.3.1.5.1. 一对一 1.3.1.5.2. 一对多 1.3.1.5.3. 多对多 1.3.2. Mybatis 1.4. Non Relational database 1.4.1."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Mythos</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Mythos</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">SpringBoot数据库相关</h1>

      <div class="post-meta">
        <span class="post-time"> 2018-12-21 </span>
        <div class="post-category">
            <a href="/categories/java/"> Java </a>
            </div>
          <span class="more-meta"> 约 2442 字 </span>
          <span class="more-meta"> 预计阅读 5 分钟 </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#数据库模块">数据库模块</a>
      <ul>
        <li><a href="#多数据源配置">多数据源配置</a></li>
        <li><a href="#连接池">连接池</a>
          <ul>
            <li><a href="#c3p0">c3p0</a></li>
            <li><a href="#druid">druid</a></li>
            <li><a href="#hikaricp">HikariCP</a></li>
          </ul>
        </li>
        <li><a href="#relational-database">Relational Database</a>
          <ul>
            <li><a href="#jpa">JPA</a></li>
            <li><a href="#mybatis">Mybatis</a></li>
          </ul>
        </li>
        <li><a href="#non-relational-database">Non Relational database</a>
          <ul>
            <li><a href="#redis">Redis</a></li>
            <li><a href="#neo4j">Neo4j</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>【注意】最后更新于 <span class="timeago" datetime="2018-12-21T10:50:38" title="December 21, 2018">December 21, 2018</span>，文中内容可能已过时，请谨慎使用。</p>
    </div>
  </div>
    <div class="post-content">
      <p>💠</p>
<ul>
<li>
<ol>
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E6%A8%A1%E5%9D%97">数据库模块</a></li>
</ol>
<ul>
<li>1.1. <a href="#%E5%A4%9A%E6%95%B0%E6%8D%AE%E6%BA%90%E9%85%8D%E7%BD%AE">多数据源配置</a></li>
<li>1.2. <a href="#%E8%BF%9E%E6%8E%A5%E6%B1%A0">连接池</a>
<ul>
<li>1.2.1. <a href="#c3p0">c3p0</a></li>
<li>1.2.2. <a href="#druid">druid</a></li>
<li>1.2.3. <a href="#hikaricp">HikariCP</a></li>
</ul>
</li>
<li>1.3. <a href="#relational-database">Relational Database</a>
<ul>
<li>1.3.1. <a href="#jpa">JPA</a>
<ul>
<li>1.3.1.1. <a href="#configuration">Configuration</a></li>
<li>1.3.1.2. <a href="#jpa%E6%95%B0%E6%8D%AE%E5%88%86%E9%A1%B5">Jpa数据分页</a></li>
<li>1.3.1.3. <a href="#%E5%8E%9F%E7%94%9Fsql">原生SQL</a></li>
<li>1.3.1.4. <a href="#mysql">Mysql</a></li>
<li>1.3.1.5. <a href="#%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB">映射关系</a>
<ul>
<li>1.3.1.5.1. <a href="#%E4%B8%80%E5%AF%B9%E4%B8%80">一对一</a></li>
<li>1.3.1.5.2. <a href="#%E4%B8%80%E5%AF%B9%E5%A4%9A">一对多</a></li>
<li>1.3.1.5.3. <a href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A">多对多</a></li>
</ul>
</li>
</ul>
</li>
<li>1.3.2. <a href="#mybatis">Mybatis</a></li>
</ul>
</li>
<li>1.4. <a href="#non-relational-database">Non Relational database</a>
<ul>
<li>1.4.1. <a href="#redis">Redis</a>
<ul>
<li>1.4.1.1. <a href="#%E6%B6%88%E6%81%AF%E8%AE%A2%E9%98%85%E5%92%8C%E5%8F%91%E5%B8%83">消息订阅和发布</a></li>
</ul>
</li>
<li>1.4.2. <a href="#neo4j">Neo4j</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>💠 2024-10-21 22:05:55</p>
<hr>
<h1 id="数据库模块">数据库模块</h1>
<blockquote>
<p><a href="https://spring.io/projects/spring-data">Spring Data</a></p>
</blockquote>
<h2 id="多数据源配置">多数据源配置</h2>
<blockquote>
<p>为什么要有多数据源?</p>
</blockquote>
<ul>
<li>业务发展和划分拆解导致业务库被拆分（例如用户库，订单库），或者异构数据源支撑（订单库MySQL，订单快照库ES）</li>
</ul>
<blockquote>
<p><a href="https://www.jianshu.com/p/34730e595a8c">Spring Boot多数据源配置与使用</a></p>
</blockquote>
<h2 id="连接池">连接池</h2>
<h3 id="c3p0">c3p0</h3>
<blockquote>
<p><a href="https://github.com/swaldman/c3p0">Github</a></p>
</blockquote>
<ul>
<li><a href="http://www.cnblogs.com/520playboy/p/7526252.html">参考博客: springboot 使用c3p0数据库连接池</a></li>
</ul>
<h3 id="druid">druid</h3>
<ul>
<li><a href="http://makaidong.com/L_Sail/1/40930_11573921.html">druid连接池的配置</a></li>
</ul>
<blockquote>
<p><a href="https://segmentfault.com/a/1190000041500544">druid连接池引起的线程blocked</a><code>驱动改名引起的连锁反应</code></p>
</blockquote>
<p>常见配置项</p>
<ul>
<li>com.alibaba.druid.pool.DruidDataSource#configFromPropety 环境变量 可配置项</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-yml" data-lang="yml"><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 初始连接数</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">initialSize</span><span class="p">:</span><span class="w"> </span><span class="m">6</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 最小连接池数量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">minIdle</span><span class="p">:</span><span class="w"> </span><span class="m">6</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 最大连接池数量</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxActive</span><span class="p">:</span><span class="w"> </span><span class="m">200</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 配置获取连接等待超时的时间</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxWait</span><span class="p">:</span><span class="w"> </span><span class="m">60000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 驱逐连接：配置间隔多久才进行一次检测，检测需要关闭的空闲连接，单位是毫秒</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">timeBetweenEvictionRunsMillis</span><span class="p">:</span><span class="w"> </span><span class="m">60000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 驱逐连接：配置一个连接在池中最小生存的时间，单位是毫秒</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">minEvictableIdleTimeMillis</span><span class="p">:</span><span class="w"> </span><span class="m">200000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 驱逐连接：配置一个连接在池中最大生存的时间，单位是毫秒</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">maxEvictableIdleTimeMillis</span><span class="p">:</span><span class="w"> </span><span class="m">280000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 心跳保活</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">keepAlive</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 心跳保活间隔，keepAlive开启才生效</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">keepAliveBetweenTimeMillis</span><span class="p">:</span><span class="w"> </span><span class="m">40000</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 配置检测连接是否有效 创建连接和心跳保活时执行</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">validationQuery</span><span class="p">:</span><span class="w"> </span><span class="l">SELECT 1</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于 timeBetweenEvictionRunsMillis ，执行validationQuery检测连接是否有效</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">testWhileIdle</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 申请连接时执行validationQuery检测连接是否有效 性能影响明显</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">testOnBorrow</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="c"># 归还连接时执行validationQuery检测连接是否有效 性能影响明显</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">testOnReturn</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>validationQuery执行场景</p>
</blockquote>
<p>周期检查 keepAlive<br>
<img src="./img/001-druid.webp" alt=""></p>
<p>获取连接时 闲置很久的连接触发检查<br>
<img src="./img/002-druid.webp" alt=""></p>
<p>创建连接时的检查<br>
<img src="./img/003-druid.webp" alt=""></p>
<hr>
<blockquote>
<p><a href="https://blog.csdn.net/qq_37993902/article/details/124777056">Druid连接检查机制</a></p>
</blockquote>
<ul>
<li><code>com.alibaba.druid.pool.DruidDataSource#createAndStartDestroyThread</code> 定时调度或单线程方式 周期性 检查连接
<ul>
<li><code>com.alibaba.druid.pool.DruidDataSource#shrink(boolean, boolean)</code> keepAlive保活，补充新连接，关闭连接（异常，空闲超时）</li>
<li><code>com.alibaba.druid.pool.ValidConnectionChecker</code> 检查连接可用，注意MySQL PG都有协议层的ping方式，更省资源（类似ws协议中的Ping报文），其他数据库一般是配置校验SQL为 <code>select 1</code></li>
</ul>
</li>
</ul>
<h3 id="hikaricp">HikariCP</h3>
<blockquote>
<p><a href="https://github.com/brettwooldridge/HikariCP">HikariCP</a></p>
</blockquote>
<hr>
<h2 id="relational-database">Relational Database</h2>
<h3 id="jpa">JPA</h3>
<blockquote>
<p>连接池:1.x 默认是tomcat-jdbc连接池 2.x 是 HikariPool</p>
</blockquote>
<blockquote>
<p><a href="https://www.jianshu.com/p/3b31270a44b1">参考: spring boot2 整合（二）JPA</a></p>
</blockquote>
<h4 id="configuration">Configuration</h4>
<blockquote>
<p><a href="https://docs.spring.io/spring-boot/docs/2.0.6.RELEASE/reference/htmlsingle/#howto-configure-jpa-properties">Official Doc</a>
<strong><code>ddl-auto</code></strong></p>
</blockquote>
<ul>
<li>
<p>JPA 默认是该配置 <code>spring.jpa.hibernate.ddl-auto</code></p>
</li>
<li>
<p>但是如上配置没有生效的话就要用 这个 <code>spring.jpa.properties.hibernate.hbm2ddl.auto</code></p>
<ol>
<li>none 什么都不做</li>
<li>create-only</li>
<li>create 先删除, 然后建立新的表</li>
<li>create-drop 先删除, 然后建立新的表, 然后在SessionFactory实例关闭后再删除</li>
<li>update 创建和修改</li>
<li>validate 校验是否一致, 不一致就报错,启动失败</li>
</ol>
</li>
<li>
<p><a href="http://blog.csdn.net/Amy_Queen/article/details/72454099">Blog: 原生SQL的写法</a></p>
</li>
<li>
<p><input disabled="" type="checkbox"> 怎么映射视图到实体上?</p>
</li>
</ul>
<h4 id="jpa数据分页">Jpa数据分页</h4>
<blockquote>
<p><a href="https://www.tianmaying.com/tutorial/spring-jpa-page-sort">参考博客</a></p>
</blockquote>
<ul>
<li>分页 page 从0开始 size是个数 sort可以不需要（如果本来就是id排序就没必要了）
<ul>
<li>原理就是 预编译SQL然后查询总数，然后再执行 必须有两条SQL执行</li>
</ul>
</li>
<li>查询的结果不包含实体的id属性</li>
</ul>
<h4 id="原生sql">原生SQL</h4>
<ul>
<li>涉及到数据的修改,就要加上前两个前缀,查询就直接写Query注解即可</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@Modifying</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Transactional</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Query</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#34;update a set b=?1&#34;</span><span class="o">,</span> <span class="n">nativeQuery</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h4 id="mysql">Mysql</h4>
<ul>
<li>1.引入依赖</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-groovy" data-lang="groovy"><span class="line"><span class="cl">	<span class="n">compile</span><span class="o">(</span><span class="s1">&#39;org.springframework.boot:spring-boot-starter-data-jpa&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">compile</span><span class="o">(</span><span class="s1">&#39;org.springframework.boot:spring-boot-starter-jdbc&#39;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">	<span class="n">runtime</span><span class="o">(</span><span class="s1">&#39;mysql:mysql-connector-java&#39;</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>2.继承接口，打好实体类的注解 @Entity</p>
</li>
<li>
<p>3.<em>切记 属性名不能使用下划线（数据库风格）不然写声明方法就会报错，jpa只是看下划线前半部分，会说找不到属性</em></p>
<ul>
<li>jpa在创建表时会把驼峰命名改成数据库风格的形式</li>
</ul>
</li>
<li>
<p>4.jpa是声明特定方法的接口，让jpa来实现并自动注入，如果是没有的方法，就可以使用@Query注解</p>
<ul>
<li>默认使用的是HQL（HQL是基于类的所以使用的是类的名字不是表的名字），可以设置下使用原生SQL</li>
</ul>
</li>
</ul>
<h4 id="映射关系">映射关系</h4>
<h5 id="一对一">一对一</h5>
<blockquote>
<p>据说这是性能最好的方式, 但是有一点让人不舒服, A的id是名存实亡的, 数据库都没有这个字段, 实际上就是B的id, 但是对象又一定要保留这个id, 不然约束通不过<br>
也就是说, 创建的时候要设置A的id的值, 但是后面却用不到这个值</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="nd">@Entity</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Data</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">A</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@Id</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@OneToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="n">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@MapsId</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">B</span> <span class="n">b</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nd">@Data</span>
</span></span><span class="line"><span class="cl"><span class="nd">@Entity</span>
</span></span><span class="line"><span class="cl"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">B</span> <span class="kd">implements</span> <span class="n">Serializable</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="nd">@Id</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">String</span> <span class="n">id</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h5 id="一对多">一对多</h5>
<ul>
<li>一方的配置是当前类的id，多方则按基本ER的规则来，注解中配置的是外键的名字, 所以当前类中的属性,外键名是不能重复的</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="c1">// 一方
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestOne</span><span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Id</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">testOneId</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@OneToMany</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;testOneId&#34;</span><span class="o">)</span><span class="c1">//这个名字可以重复，最终会有一个随机码生成
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">private</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">TestMany</span><span class="o">&gt;</span> <span class="n">testManySet</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 多方
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestMany</span> <span class="o">{</span>    
</span></span><span class="line"><span class="cl">    <span class="nd">@Id</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">String</span> <span class="n">testManyId</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@ManyToOne</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#34;testOneId&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="kd">private</span> <span class="n">TestOne</span> <span class="n">testOneId</span><span class="o">;</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><input disabled="" type="checkbox"> 问题: 当两个表互相引用了, 需要修改表结构 ,怎么删除重建两张表结构, 简单的命令会陷入死锁</li>
</ul>
<hr>
<h5 id="多对多">多对多</h5>
<h3 id="mybatis">Mybatis</h3>
<blockquote>
<p><a href="/Java/Ecosystem/Mybatis.md">Mybatis</a></p>
</blockquote>
<hr>
<h2 id="non-relational-database">Non Relational database</h2>
<h3 id="redis">Redis</h3>
<blockquote>
<p><a href="https://spring.io/projects/spring-data-redis">Spring Data Redis</a></p>
</blockquote>
<p><em>配置连接信息</em></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">    # REDIS (RedisProperties)
</span></span><span class="line"><span class="cl">    # Redis数据库索引（默认为0）
</span></span><span class="line"><span class="cl">    spring.redis.database=0
</span></span><span class="line"><span class="cl">    # Redis服务器地址
</span></span><span class="line"><span class="cl">    spring.redis.host=127.0.0.1
</span></span><span class="line"><span class="cl">    # Redis服务器连接端口
</span></span><span class="line"><span class="cl">    spring.redis.port=6379
</span></span><span class="line"><span class="cl">    # Redis服务器连接密码（默认为空）
</span></span><span class="line"><span class="cl">    spring.redis.password=
</span></span><span class="line"><span class="cl">    # 连接池最大连接数（使用负值表示没有限制）
</span></span><span class="line"><span class="cl">    spring.redis.pool.max-active=8
</span></span><span class="line"><span class="cl">    # 连接池最大阻塞等待时间（使用负值表示没有限制）
</span></span><span class="line"><span class="cl">    spring.redis.pool.max-wait=-1
</span></span><span class="line"><span class="cl">    # 连接池中的最大空闲连接
</span></span><span class="line"><span class="cl">    spring.redis.pool.max-idle=8
</span></span><span class="line"><span class="cl">    # 连接池中的最小空闲连接
</span></span><span class="line"><span class="cl">    spring.redis.pool.min-idle=0
</span></span><span class="line"><span class="cl">    # 连接超时时间（毫秒）0不超时
</span></span><span class="line"><span class="cl">    spring.redis.timeout=0
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>在一个配置类中复制如下代码即可使用 StringRedisTemplate RedisTemplate 的实例</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="kd">public</span> <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">redisTemplate</span><span class="o">(</span><span class="n">RedisConnectionFactory</span> <span class="n">factory</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">RedisTemplate</span><span class="o">&lt;</span><span class="n">Object</span><span class="o">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="n">template</span> <span class="o">=</span> <span class="k">new</span> <span class="n">RedisTemplate</span><span class="o">&lt;&gt;();</span>
</span></span><span class="line"><span class="cl">        <span class="n">Jackson2JsonRedisSerializer</span> <span class="n">jackson2JsonRedisSerializer</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Jackson2JsonRedisSerializer</span><span class="o">&lt;&gt;(</span><span class="n">Object</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">template</span><span class="o">.</span><span class="na">setConnectionFactory</span><span class="o">(</span><span class="n">factory</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">ObjectMapper</span> <span class="n">om</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ObjectMapper</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">om</span><span class="o">.</span><span class="na">setVisibility</span><span class="o">(</span><span class="n">PropertyAccessor</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">JsonAutoDetect</span><span class="o">.</span><span class="na">Visibility</span><span class="o">.</span><span class="na">ANY</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">om</span><span class="o">.</span><span class="na">enableDefaultTyping</span><span class="o">(</span><span class="n">ObjectMapper</span><span class="o">.</span><span class="na">DefaultTyping</span><span class="o">.</span><span class="na">NON_FINAL</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">jackson2JsonRedisSerializer</span><span class="o">.</span><span class="na">setObjectMapper</span><span class="o">(</span><span class="n">om</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 值序列化采用 jackson2JsonRedisSerializer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">template</span><span class="o">.</span><span class="na">setValueSerializer</span><span class="o">(</span><span class="n">jackson2JsonRedisSerializer</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// 键序列化采用 StringRedisSerializer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">template</span><span class="o">.</span><span class="na">setKeySerializer</span><span class="o">(</span><span class="k">new</span> <span class="n">StringRedisSerializer</span><span class="o">());</span>
</span></span><span class="line"><span class="cl">        <span class="n">template</span><span class="o">.</span><span class="na">afterPropertiesSet</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">template</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="nd">@Bean</span>
</span></span><span class="line"><span class="cl">    <span class="n">StringRedisTemplate</span> <span class="nf">template</span><span class="o">(</span><span class="n">RedisConnectionFactory</span> <span class="n">connectionFactory</span><span class="o">)</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="k">new</span> <span class="n">StringRedisTemplate</span><span class="o">(</span><span class="n">connectionFactory</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>两个对象的简单使用</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">    <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">set</span><span class="o">(</span><span class="s">&#34;aaa&#34;</span><span class="o">,</span> <span class="s">&#34;hello&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">String</span> <span class="n">result</span> <span class="o">=</span> <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">opsForValue</span><span class="o">().</span><span class="na">get</span><span class="o">(</span><span class="s">&#34;aaa&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//获取所有
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Set</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">keysList</span> <span class="o">=</span>  <span class="n">stringRedisTemplate</span><span class="o">.</span><span class="na">keys</span><span class="o">(</span><span class="s">&#34;*&#34;</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="o">(</span><span class="n">String</span> <span class="n">temp</span> <span class="o">:</span><span class="n">keysList</span><span class="o">){</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="n">temp</span><span class="o">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>以上配置的template都是只是建立在最简单的键值对上，String-String，所以对象使用的是json来存储</li>
<li>但是使用的时候如同使用MySQL一样，是ORM框架自动处理数据的转换</li>
</ul>
<h4 id="消息订阅和发布">消息订阅和发布</h4>
<p><a href="https://www.tianmaying.com/tutorial/springboot-redis-message">参考: Spring Boot使用Redis进行消息的发布订阅</a></p>
<h3 id="neo4j">Neo4j</h3>
<p>注意版本不同配置方式不同，可通过自动装配类找到配置类进行分辨</p>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">Kuangcp</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">
        2018-12-21
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      <div class="post-tags">
          <a href="/tags/springboot/">SpringBoot</a>
          </div>
      <nav class="post-nav">
        <a class="prev" href="/post/java/spring/springmvc/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">SpringMVC</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        <a class="next" href="/post/java/spring/springboot2/">
            <span class="next-text nav-default">SpringBoot2 新特性</span>
            <span class="next-text nav-mobile">下一篇</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/Kuangcp" class="iconfont icon-github" title="github"></a>
  <a href="https://www.kuangcp.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    由 <a class="hexo-link" href="https://gohugo.io">Hugo</a> 强力驱动
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    主题 - 
    <a class="theme-link" href="https://gitee.com/gin9/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span>
    <span>Kuangcp</span>
    
    <br/><span><a href='http://beian.miit.gov.cn/'; target=_blank>www.kuangcp.top</a></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>






</body>
</html>
