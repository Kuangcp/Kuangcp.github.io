<!DOCTYPE html>
<html lang="zh-cn">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Clickhouse - Mythos Â· Java Developer</title>
  <meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">


<meta name="author" content="Kuangcp" /><meta name="description" content="ğŸ’  Clickhouse 1.1. å®‰è£… 1.2. æ•°æ®ç±»å‹ 1.2.1. bitmap 1.2.2. Decimal 1.3. èšåˆå‡½æ•° æ•°æ®åº“å¼•æ“ è¡¨å¼•æ“ 3.1. MergeTree å¼•æ“å®¶æ— 3.2. åˆ†å¸ƒå¼è¡¨å¼•æ“ Distributed è¡¨ 4.1. åˆ†åŒºè¡¨ å®¢æˆ·ç«¯ 5.1. Java Explain Tips ğŸ’  2024-10-17 20:31:57 Clickhouse Official Site What is ClickHouse? å…³è”å¼€æºé¡¹ç›®ï¼š Sentry" /><meta name="keywords" content="Hugo, theme, even" />






<meta name="generator" content="Hugo 0.99.0 with theme even" />


<link rel="canonical" href="https://www.kuangcp.top/post/database/olap/clickhouse/" />
<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/manifest.json">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">



<link href="/sass/main.min.b5a744db6de49a86cadafb3b70f555ab443f83c307a483402259e94726b045ff.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css" integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin="anonymous">


<meta property="og:title" content="Clickhouse" />
<meta property="og:description" content="ğŸ’  Clickhouse 1.1. å®‰è£… 1.2. æ•°æ®ç±»å‹ 1.2.1. bitmap 1.2.2. Decimal 1.3. èšåˆå‡½æ•° æ•°æ®åº“å¼•æ“ è¡¨å¼•æ“ 3.1. MergeTree å¼•æ“å®¶æ— 3.2. åˆ†å¸ƒå¼è¡¨å¼•æ“ Distributed è¡¨ 4.1. åˆ†åŒºè¡¨ å®¢æˆ·ç«¯ 5.1. Java Explain Tips ğŸ’  2024-10-17 20:31:57 Clickhouse Official Site What is ClickHouse? å…³è”å¼€æºé¡¹ç›®ï¼š Sentry" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.kuangcp.top/post/database/olap/clickhouse/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-03-31T09:58:36+00:00" />
<meta property="article:modified_time" content="2023-03-31T09:58:36+00:00" />

<meta itemprop="name" content="Clickhouse">
<meta itemprop="description" content="ğŸ’  Clickhouse 1.1. å®‰è£… 1.2. æ•°æ®ç±»å‹ 1.2.1. bitmap 1.2.2. Decimal 1.3. èšåˆå‡½æ•° æ•°æ®åº“å¼•æ“ è¡¨å¼•æ“ 3.1. MergeTree å¼•æ“å®¶æ— 3.2. åˆ†å¸ƒå¼è¡¨å¼•æ“ Distributed è¡¨ 4.1. åˆ†åŒºè¡¨ å®¢æˆ·ç«¯ 5.1. Java Explain Tips ğŸ’  2024-10-17 20:31:57 Clickhouse Official Site What is ClickHouse? å…³è”å¼€æºé¡¹ç›®ï¼š Sentry"><meta itemprop="datePublished" content="2023-03-31T09:58:36+00:00" />
<meta itemprop="dateModified" content="2023-03-31T09:58:36+00:00" />
<meta itemprop="wordCount" content="2561">
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Clickhouse"/>
<meta name="twitter:description" content="ğŸ’  Clickhouse 1.1. å®‰è£… 1.2. æ•°æ®ç±»å‹ 1.2.1. bitmap 1.2.2. Decimal 1.3. èšåˆå‡½æ•° æ•°æ®åº“å¼•æ“ è¡¨å¼•æ“ 3.1. MergeTree å¼•æ“å®¶æ— 3.2. åˆ†å¸ƒå¼è¡¨å¼•æ“ Distributed è¡¨ 4.1. åˆ†åŒºè¡¨ å®¢æˆ·ç«¯ 5.1. Java Explain Tips ğŸ’  2024-10-17 20:31:57 Clickhouse Official Site What is ClickHouse? å…³è”å¼€æºé¡¹ç›®ï¼š Sentry"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->

</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">Mythos</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <a href="/">
        <li class="mobile-menu-item">Home</li>
      </a><a href="/post/">
        <li class="mobile-menu-item">Archives</li>
      </a><a href="/tags/">
        <li class="mobile-menu-item">Tags</li>
      </a><a href="/categories/">
        <li class="mobile-menu-item">Categories</li>
      </a>
  </ul>
</nav>
  <div class="container" id="mobile-panel">
    <header id="header" class="header">
        <div class="logo-wrapper">
  <a href="/" class="logo">Mythos</a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    <li class="menu-item">
        <a class="menu-item-link" href="/">Home</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/post/">Archives</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/tags/">Tags</a>
      </li><li class="menu-item">
        <a class="menu-item-link" href="/categories/">Categories</a>
      </li>
  </ul>
</nav>
    </header>

    <main id="main" class="main">
      <div class="content-wrapper">
        <div id="content" class="content">
          <article class="post">
    
    <header class="post-header">
      <h1 class="post-title">Clickhouse</h1>

      <div class="post-meta">
        <span class="post-time"> 2023-03-31 </span>
        
          <span class="more-meta"> çº¦ 2561 å­— </span>
          <span class="more-meta"> é¢„è®¡é˜…è¯» 6 åˆ†é’Ÿ </span>
        
      </div>
    </header>

    <div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">æ–‡ç« ç›®å½•</h2>
  <div class="post-toc-content always-active">
    <nav id="TableOfContents">
  <ul>
    <li><a href="#clickhouse">Clickhouse</a>
      <ul>
        <li><a href="#å®‰è£…">å®‰è£…</a></li>
        <li><a href="#æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</a>
          <ul>
            <li><a href="#bitmap">bitmap</a></li>
            <li><a href="#decimal">Decimal</a></li>
          </ul>
        </li>
        <li><a href="#èšåˆå‡½æ•°">èšåˆå‡½æ•°</a></li>
      </ul>
    </li>
    <li><a href="#æ•°æ®åº“å¼•æ“">æ•°æ®åº“å¼•æ“</a></li>
    <li><a href="#è¡¨å¼•æ“">è¡¨å¼•æ“</a>
      <ul>
        <li><a href="#mergetree-å¼•æ“å®¶æ—">MergeTree å¼•æ“å®¶æ—</a></li>
        <li><a href="#åˆ†å¸ƒå¼è¡¨å¼•æ“-distributed">åˆ†å¸ƒå¼è¡¨å¼•æ“ Distributed</a></li>
      </ul>
    </li>
    <li><a href="#è¡¨">è¡¨</a>
      <ul>
        <li><a href="#åˆ†åŒºè¡¨">åˆ†åŒºè¡¨</a></li>
      </ul>
    </li>
    <li><a href="#å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</a>
      <ul>
        <li><a href="#java">Java</a></li>
      </ul>
    </li>
    <li><a href="#explain">Explain</a></li>
    <li><a href="#tips">Tips</a></li>
  </ul>
</nav>
  </div>
</div>
  <div class="post-outdated">
    <div class="warn">
      <p>ã€æ³¨æ„ã€‘æœ€åæ›´æ–°äº <span class="timeago" datetime="2023-03-31T09:58:36" title="March 31, 2023">March 31, 2023</span>ï¼Œæ–‡ä¸­å†…å®¹å¯èƒ½å·²è¿‡æ—¶ï¼Œè¯·è°¨æ…ä½¿ç”¨ã€‚</p>
    </div>
  </div>
    <div class="post-content">
      <p>ğŸ’ </p>
<ul>
<li>
<ol>
<li><a href="#clickhouse">Clickhouse</a></li>
</ol>
<ul>
<li>1.1. <a href="#%E5%AE%89%E8%A3%85">å®‰è£…</a></li>
<li>1.2. <a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">æ•°æ®ç±»å‹</a>
<ul>
<li>1.2.1. <a href="#bitmap">bitmap</a></li>
<li>1.2.2. <a href="#decimal">Decimal</a></li>
</ul>
</li>
<li>1.3. <a href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0">èšåˆå‡½æ•°</a></li>
</ul>
</li>
<li>
<ol start="2">
<li><a href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E5%BC%95%E6%93%8E">æ•°æ®åº“å¼•æ“</a></li>
</ol>
</li>
<li>
<ol start="3">
<li><a href="#%E8%A1%A8%E5%BC%95%E6%93%8E">è¡¨å¼•æ“</a></li>
</ol>
<ul>
<li>3.1. <a href="#mergetree-%E5%BC%95%E6%93%8E%E5%AE%B6%E6%97%8F">MergeTree å¼•æ“å®¶æ—</a></li>
<li>3.2. <a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E8%A1%A8%E5%BC%95%E6%93%8E-distributed">åˆ†å¸ƒå¼è¡¨å¼•æ“ Distributed</a></li>
</ul>
</li>
<li>
<ol start="4">
<li><a href="#%E8%A1%A8">è¡¨</a></li>
</ol>
<ul>
<li>4.1. <a href="#%E5%88%86%E5%8C%BA%E8%A1%A8">åˆ†åŒºè¡¨</a></li>
</ul>
</li>
<li>
<ol start="5">
<li><a href="#%E5%AE%A2%E6%88%B7%E7%AB%AF">å®¢æˆ·ç«¯</a></li>
</ol>
<ul>
<li>5.1. <a href="#java">Java</a></li>
</ul>
</li>
<li>
<ol start="6">
<li><a href="#explain">Explain</a></li>
</ol>
</li>
<li>
<ol start="7">
<li><a href="#tips">Tips</a></li>
</ol>
</li>
</ul>
<p>ğŸ’  2024-10-17 20:31:57</p>
<hr>
<h1 id="clickhouse">Clickhouse</h1>
<blockquote>
<p><a href="https://clickhouse.com">Official Site</a></p>
</blockquote>
<blockquote>
<p><a href="https://medium.com/doublecloud-insights/what-is-clickhouse-a-comprehensive-guide-for-getting-started-5aae9afd38b0">What is ClickHouse? </a></p>
</blockquote>
<ul>
<li>å…³è”å¼€æºé¡¹ç›®ï¼š Sentry <a href="https://github.com/clickvisual/clickvisual">clickvisual</a></li>
</ul>
<hr>
<h2 id="å®‰è£…">å®‰è£…</h2>
<blockquote>
<p><a href="https://github.com/ClickHouse/examples/blob/main/docker-compose-recipes/README.md">Docker compose å®‰è£…</a><br>
<a href="https://github.com/tetafro/clickhouse-cluster">Clickhouse cluster built with docker-compose.</a></p>
</blockquote>
<blockquote>
<p>ä¾‹å¦‚ä»¥ä¸‹é…ç½®ä¸º ä¸¤ä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡ä¸¤ä¸ªå‰¯æœ¬</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl">    <span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;yandex&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;clickhouse_remote_servers&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;default_cluster&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;shard&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;internal_replication&gt;</span>false<span class="nt">&lt;/internal_replication&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;replica&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;host&gt;</span>10.0.3.27<span class="nt">&lt;/host&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;port&gt;</span>9000<span class="nt">&lt;/port&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/replica&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;replica&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;host&gt;</span>10.0.3.41<span class="nt">&lt;/host&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;port&gt;</span>9000<span class="nt">&lt;/port&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/replica&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/shard&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;shard&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;internal_replication&gt;</span>true<span class="nt">&lt;/internal_replication&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;replica&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;host&gt;</span>10.0.3.46<span class="nt">&lt;/host&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;port&gt;</span>9000<span class="nt">&lt;/port&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/replica&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;replica&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;host&gt;</span>10.0.3.26<span class="nt">&lt;/host&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;port&gt;</span>9000<span class="nt">&lt;/port&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/replica&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/shard&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/default_cluster&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/clickhouse_remote_servers&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;zookeeper-servers&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;node&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;host&gt;</span>10.0.3.12<span class="nt">&lt;/host&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;port&gt;</span>2181<span class="nt">&lt;/port&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/node&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;node&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;host&gt;</span>10.0.3.3<span class="nt">&lt;/host&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;port&gt;</span>2181<span class="nt">&lt;/port&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/node&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;node&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;host&gt;</span>10.0.3.23<span class="nt">&lt;/host&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;port&gt;</span>2181<span class="nt">&lt;/port&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/node&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/zookeeper-servers&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/yandex&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h2 id="æ•°æ®ç±»å‹">æ•°æ®ç±»å‹</h2>
<blockquote>
<p><a href="https://clickhouse.com/docs/en/sql-reference/data-types">ClickHouse Data Types</a></p>
</blockquote>
<p>æ³¨æ„Ckä¸­å»ºè¡¨æ—¶å­—æ®µç±»å‹é»˜è®¤æ˜¯éNullçš„ï¼Œå’Œå¸¸è§çš„ä¸šåŠ¡æ•°æ®åº“MySQLç­‰ç›¸åï¼Œæ”¯æŒNullæ•°æ®éœ€è¦æ˜¾å¼æŒ‡å®šï¼Œä¾‹å¦‚ï¼š Nullable(Int)</p>
<h3 id="bitmap">bitmap</h3>
<blockquote>
<p>å¹¶æ²¡æœ‰è¿™ä¸ªç±»å‹å®šä¹‰ï¼Œåªæ˜¯åœ¨ä½¿ç”¨æ—¶ç”±æ•°æ®å­˜å‚¨æ–¹å¼å­˜åœ¨ï¼Œç±»ä¼¼äºRedisçš„bitmapã€‚</p>
</blockquote>
<p>ä½å›¾å¯¹è±¡æœ‰ä¸¤ç§æ„é€ æ–¹æ³•ã€‚ä¸€ä¸ªæ˜¯ç”±èšåˆå‡½æ•°groupBitmapStateæ„é€ çš„ï¼Œå¦ä¸€ä¸ªæ˜¯ç”±Array Objectæ„é€ çš„ã€‚åŒæ—¶è¿˜å¯ä»¥å°†ä½å›¾å¯¹è±¡è½¬åŒ–ä¸ºæ•°ç»„å¯¹è±¡<code>bitmapToArray()</code>ã€‚</p>
<p><a href="https://github.com/RoaringBitmap/CRoaring">Roaring bitmaps</a><br>
<a href="https://zhuanlan.zhihu.com/p/480345952">BitMapåŠå…¶åœ¨ClickHouseä¸­çš„åº”ç”¨</a><code>CKé’ˆå¯¹æ•°æ®çš„åˆ†å¸ƒæƒ…å†µåšäº†ä¸€äº›ä¼˜åŒ–</code></p>
<h3 id="decimal">Decimal</h3>
<blockquote>
<p><a href="https://clickhouse.com/docs/en/sql-reference/data-types/decimal">Data TypesDecimal</a></p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:left">min</th>
<th style="text-align:left">max</th>
<th style="text-align:left">type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left">9</td>
<td style="text-align:left">Decimal32</td>
</tr>
<tr>
<td style="text-align:left">10</td>
<td style="text-align:left">18</td>
<td style="text-align:left">Decimal64</td>
</tr>
<tr>
<td style="text-align:left">19</td>
<td style="text-align:left">38</td>
<td style="text-align:left">Decimal128</td>
</tr>
<tr>
<td style="text-align:left">39</td>
<td style="text-align:left">76</td>
<td style="text-align:left">Decimal256</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Tips</p>
</blockquote>
<ul>
<li><a href="https://github.com/ClickHouse/ClickHouse/issues/30542">cast as decimal is very slow</a> <code>Decimal128 256 ç›¸è¾ƒäº 64å’Œ32 æœ‰è¾ƒå¤§çš„æ€§èƒ½å·®è·ï¼Œå¯ä»¥ç”¨å…¶ä¸­SQLåšæµ‹è¯•</code>
<ul>
<li><code>SELECT sum(CAST(number + 1., 'Decimal(17, 1)'))ã€€FROM numbers(100000000);</code> è‡ªå»ºçš„CKé›†ç¾¤å†…çœ‹åˆ°128è€—æ—¶æ˜¯64çš„ä¸‰å€ <strong>å®é™…æƒ…å†µå®é™…åˆ†æï¼Œä»…ä¾›å‚è€ƒ</strong></li>
<li>å› ä¸ºä»Decimal128ç±»å‹å¼€å§‹CKéƒ½è¦æ¨¡æ‹Ÿè®¡ç®—æ¥æé«˜ç²¾åº¦ï¼ŒCPUæˆæœ¬æ›´å¤§</li>
<li>CK22.3.5.5ç‰ˆæœ¬ä¸Š <code>ROUND(cast(AVG(ifNull(sale_amount, 0)) AS Decimal(76,38)), 4)</code> Roundä¼šä¸èµ·ä½œç”¨ï¼Œè®¡ç®—ç»“æœä»æ˜¯å¾ˆé•¿çš„å°æ•°ä½</li>
</ul>
</li>
</ul>
<blockquote>
<p><code>SELECT sumWithOverflow(CAST(number + 1., 'Decimal(3, 1)')) as res , toTypeName(res)ã€€FROM numbers(1000000);</code></p>
</blockquote>
<ul>
<li>åœ¨åšsumè®¡ç®—æ—¶ï¼Œè¡¨çš„æºå­—æ®µå¤§å°ä¸å¤Ÿæ—¶ä¼šè‡ªåŠ¨å¢é•¿ç±»å‹ï¼Œ ä½†æ˜¯å¦‚æœä½¿ç”¨ sumWithOverflow å°±ä¸ä¼šæ‰©å¤§ç±»å‹ï¼Œå› æ­¤è®¡ç®—ç»“æœä¹Ÿæ˜¯é”™è¯¯çš„</li>
</ul>
<hr>
<h2 id="èšåˆå‡½æ•°">èšåˆå‡½æ•°</h2>
<blockquote>
<p><a href="https://clickhouse.com/docs/en/sql-reference/aggregate-functions/reference">List of Aggregate Functions</a></p>
</blockquote>
<ul>
<li>æ³¨æ„avgå‡½æ•°å›ºå®šè¿”å›Float64ç±»å‹ï¼Œéœ€è¦æŒ‰æ•°æ®è¦æ±‚åšç±»å‹è½¬æ¢å¤„ç†è§„é¿åç»­è®¡ç®—çš„ç²¾åº¦æŸå¤±é—®é¢˜</li>
</ul>
<hr>
<h1 id="æ•°æ®åº“å¼•æ“">æ•°æ®åº“å¼•æ“</h1>
<ul>
<li>Atomic</li>
<li>MySQL å…³è”è¿œç¨‹åº“è¡¨</li>
<li>MaterializedMySQL åŸç”Ÿå®ç°MySQLå¼•æ“ æ”¯æŒä»MySQLå…¨é‡åŠå¢é‡å®æ—¶åŒæ­¥</li>
<li>Lazy</li>
<li>PostgreSQL å…³è”è¿œç¨‹åº“è¡¨</li>
<li>MaterializedPostgreSQL åŸç”Ÿå®ç°PGå¼•æ“</li>
<li>Replicated</li>
<li>SQLite</li>
</ul>
<h1 id="è¡¨å¼•æ“">è¡¨å¼•æ“</h1>
<blockquote>
<p><a href="https://clickhouse.com/docs/en/engines/table-engines">doc: Table Engines</a></p>
</blockquote>
<p>åˆ†ä¸ºï¼šMTå®¶æ—ï¼Œå¤–éƒ¨è¡¨ï¼ˆé›†æˆï¼‰å¼•æ“ï¼Œæ—¥å¿—å¼•æ“ï¼Œç‰¹æ®Šå¼•æ“ï¼ˆDistributedï¼ŒFile,URL,Memoryç­‰ç­‰ï¼‰</p>
<h2 id="mergetree-å¼•æ“å®¶æ—">MergeTree å¼•æ“å®¶æ—</h2>
<ul>
<li>MergeTree</li>
<li>ReplacingMergeTree</li>
<li>SummingMergeTree</li>
<li>AggregatingMergeTree</li>
<li>CollapsingMergeTree</li>
<li>VersionedCollapsingMergeTree</li>
<li>GraphiteMergeTree</li>
</ul>
<h2 id="åˆ†å¸ƒå¼è¡¨å¼•æ“-distributed">åˆ†å¸ƒå¼è¡¨å¼•æ“ Distributed</h2>
<blockquote>
<p><a href="https://clickhouse.com/docs/en/engines/table-engines/special/distributed">doc: distributed</a></p>
</blockquote>
<p>è¿™ç§ç±»å‹çš„è¡¨ä¸ä¼šå­˜å‚¨æ•°æ®ï¼Œå¯ä»¥å½“ä½œå…³è”è¡¨çš„ä¸€å±‚ä»£ç†ï¼Œå®ç°å¹¶è¡ŒæŸ¥è¯¢å’Œæ•°æ®å†™å…¥çš„åˆ†å‘.</p>
<p>æŸ¥è¯¢Distributedè¡¨å¼•æ“çš„è¿‡ç¨‹æ˜¯ï¼š å…ˆæŸ¥æ¥æ”¶è¯·æ±‚èŠ‚ç‚¹æœ¬åœ°çš„è¡¨ï¼ˆå’Œå½“å‰èŠ‚ç‚¹åŒåˆ†ç‰‡ä¸‹çš„Replicationå‰¯æœ¬èŠ‚ç‚¹<strong>ä¸ä¼šæ¥æ”¶åˆ°æŸ¥è¯¢çš„è¯·æ±‚</strong>ï¼‰ï¼Œå¯¹å‰©ä½™å…¨éƒ¨åˆ†ç‰‡å‘é€è¯·æ±‚ï¼ˆåˆ†ç‰‡ä¸­çš„ä¸€ä¸ªéšæœºå‰¯æœ¬ï¼‰ï¼Œç„¶åå†èšåˆå„ä¸ªåˆ†ç‰‡è¿”å›çš„æ•°æ®ï¼Œæœ€åè¿”å›æœ€ç»ˆç»“æœã€‚<br>
æ³¨æ„å¯é€šè¿‡è®¾ç½®ä¸åŒçš„clusteræ¥å®ç°æ˜¯å¦é‡‡ç”¨å‰¯æœ¬èŠ‚ç‚¹ï¼Œå¦‚æœæ˜¯æœªè®¾ç½®å‰¯æœ¬çš„èŠ‚ç‚¹ï¼Œæ¯ä¸ªåˆ†ç‰‡ä¸ä¼šæœ‰å‰¯æœ¬å†—ä½™ã€‚</p>
<p><img src="./img/001-dis-send-query.webp" alt="">
<img src="./img/002-dis-merge-result.webp" alt=""></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- æŸ¥çœ‹å¤åˆ¶è¡¨æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="k">database</span><span class="p">,</span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">cnt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="p">,</span><span class="k">sum</span><span class="p">(</span><span class="k">case</span><span class="w"> </span><span class="k">when</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="s1">&#39;ReplicatedMergeTree&#39;</span><span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="k">end</span><span class="p">)</span><span class="w"> </span><span class="n">cnt_rmt</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">clusterAllReplicas</span><span class="p">(</span><span class="s1">&#39;default_cluster&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;system.tables&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">group</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="k">desc</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- æŸ¥çœ‹å¤åˆ¶è¡¨æ˜ç»†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">select</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="p">,</span><span class="n">engine</span><span class="p">,</span><span class="w"> </span><span class="n">hostname</span><span class="p">(),</span><span class="w"> </span><span class="n">metadata_modification_time</span><span class="p">,</span><span class="w"> </span><span class="n">total_rows</span><span class="p">,</span><span class="w"> </span><span class="n">total_bytes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">from</span><span class="w"> </span><span class="n">clusterAllReplicas</span><span class="p">(</span><span class="s1">&#39;default_cluster&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;system.tables&#39;</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">where</span><span class="w"> </span><span class="k">database</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;db&#39;</span><span class="w"> </span><span class="k">and</span><span class="w"> </span><span class="n">engine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ReplicatedMergeTree&#39;</span><span class="p">;</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><hr>
<blockquote>
<p><a href="https://cloud.tencent.com/developer/article/1748216">ClickHouseæ¡ˆä¾‹ï¼šæŸ¥è¯¢ç»“æœä¸ä¸€è‡´</a><br>
æ³¨æ„ åœ¨è®¾ç½®æœ‰å‰¯æœ¬çš„é›†ç¾¤é‡Œï¼Œåˆ†å¸ƒå¼è¡¨éƒ½éœ€è¦å…³è”å‰¯æœ¬è¡¨ Replicated MergeTree ä½œä¸ºæ•°æ®è¡¨ï¼Œå¦‚æœä½¿ç”¨æ™®é€šçš„MTè¡¨å¼•æ“ï¼Œä¼šå¯¼è‡´æŸ¥è¯¢å’Œå†™å…¥éƒ½ä¼šé‡åˆ°å¥‡æ€ªçš„é—®é¢˜ã€‚</p>
</blockquote>
<ul>
<li>å†™å…¥ï¼š ä¼šæœ‰éƒ¨åˆ†èŠ‚ç‚¹ä¸Šæ²¡æœ‰æ•°æ®ï¼Œä½†æ˜¯å…¨éƒ¨èŠ‚ç‚¹çš„æ•°æ®æ€»é‡æ˜¯å¯¹çš„</li>
<li>æŸ¥è¯¢ï¼š ä¸€æ¡SQLæ¯æ¬¡æŸ¥è¯¢çš„ç»“æœéƒ½ä¸ä¸€æ ·ï¼ˆå„ä¸ªåˆ†ç‰‡å†…éšæœºé€‰æ‹©å‰¯æœ¬å†åˆå¹¶æŸ¥è¯¢ç»“æœè€Œå¯¼è‡´çš„ï¼‰</li>
</ul>
<hr>
<h1 id="è¡¨">è¡¨</h1>
<blockquote>
<p><a href="https://clickhouse.com/docs/en/sql-reference/statements/create/table">doc: create table</a></p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="w">    </span><span class="c1">-- å¤åˆ¶è¡¨ç»“æ„ï¼Œå¯ä»¥å¿«é€Ÿå»ºç«‹ ç›¸åŒè¡¨ç»“æ„ï¼Œä½†æ˜¯ä¸åŒå¼•æ“å’Œå­˜å‚¨æ–¹æ¡ˆ çš„è¡¨ã€‚ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="c1">-- ä¾‹å¦‚å¤§é‡æ•°æ®çš„å¯¼å…¥åœºæ™¯ï¼Œç›´æ¥é€šè¿‡JDBCå†™å…¥åˆ†å¸ƒå¼åˆ†åŒºå¤åˆ¶è¡¨ å¯¹CKçš„å‹åŠ›ï¼ˆZKåŒæ­¥çš„å‹åŠ›ï¼‰ ä¼šæ¯” JDBCå…ˆå†™å…¥åˆ†å¸ƒå¼åˆ†åŒºè¡¨ å†ckå†…éƒ¨insertè½¬ç§»åˆ°åˆ†å¸ƒå¼åˆ†åŒºå¤åˆ¶è¡¨ çš„æ–¹æ¡ˆå°ï¼Œä¸”ç¨³å®š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="w">    </span><span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">[</span><span class="k">IF</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">EXISTS</span><span class="p">]</span><span class="w"> </span><span class="p">[</span><span class="n">db</span><span class="p">.]</span><span class="k">table_name</span><span class="w"> </span><span class="n">CLONE</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="p">[</span><span class="n">db2</span><span class="p">.]</span><span class="n">name2</span><span class="w"> </span><span class="p">[</span><span class="n">ENGINE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">engine</span><span class="p">]</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åˆ†åŒºè¡¨">åˆ†åŒºè¡¨</h2>
<blockquote>
<p><a href="https://stackoverflow.com/questions/75439190/what-is-the-actual-use-of-partitions-in-clickhouse">What is the actual use of partitions in clickhouse?</a><code>æ•°æ®æœ‰æ˜æ˜¾çš„åˆ†åŒºç‰¹å¾ï¼ˆä¾‹å¦‚æ—¶é—´åºåˆ—æ•°æ®ï¼‰ï¼ŒæŒ‰åˆ†åŒºåšTTLï¼ŒæŸ¥è¯¢æ—¶é€šå¸¸ä¸ä¼šè·¨å¤šä¸ªåˆ†åŒºï¼Œåˆ†åŒºæ•°åœ¨100ä»¥å†…ï¼ˆåˆ†åŒºå¾ˆå¤šæ—¶ä¼šæ˜æ˜¾å½±å“è¯»å†™çš„æ€§èƒ½ï¼‰</code></p>
</blockquote>
<hr>
<h1 id="å®¢æˆ·ç«¯">å®¢æˆ·ç«¯</h1>
<blockquote>
<p><a href="https://github.com/getsentry/snuba">snuba</a><code>Sentryå¼€å‘ï¼Œ CKçš„ä¸€ä¸ªæŸ¥è¯¢å±‚</code></p>
</blockquote>
<h2 id="java">Java</h2>
<blockquote>
<p><a href="https://clickhouse.com/docs/en/integrations/jdbc/jdbc-with-clickhouse">Connecting ClickHouse to external data sources with JDBC</a><br>
JDBCçš„é©±åŠ¨å®ç°æ˜¯é€šè¿‡HTTPåè®®å’ŒClickhouseé€šä¿¡ <a href="https://github.com/ClickHouse/clickhouse-java">Github: clickhouse-java</a><code>com.clickhouse.client.internal.apache.hc.client5.http.impl.io.DefaultManagedHttpClientConnection</code></p>
</blockquote>
<p>ä½ç‰ˆæœ¬é©±åŠ¨æ²¡æœ‰å®ç°è´Ÿè½½å‡è¡¡ï¼Œéœ€è¦åœ¨æ•°æ®èŠ‚ç‚¹å‰åŠ ä¸€å±‚ <a href="https://github.com/ContentSquare/chproxy">chproxy</a>, ä½†æ˜¯å®é™…ä¸Šä¹Ÿå¯ä»¥è‡ªå·±å®ç°è´Ÿè½½å‡è¡¡ç®—æ³•(ä¾‹å¦‚ï¼šä¾æ®æŸä¸ªæ—¶é—´çª—å£å†…æ‰€æœ‰èŠ‚ç‚¹çš„è´Ÿè½½ï¼Œè¿æ¥ç­‰æƒ…å†µæ¥é€‰æ‹©åˆé€‚çš„èŠ‚ç‚¹)</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl">        <span class="n">Properties</span> <span class="n">properties</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;socket_keepalive&#34;</span><span class="o">,</span> <span class="s">&#34;true&#34;</span><span class="o">);</span> <span class="c1">//socket_timeoutæ—¶é—´ç”±ç³»ç»Ÿè®¾ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;auto_discovery&#34;</span><span class="o">,</span> <span class="s">&#34;true&#34;</span><span class="o">);</span> <span class="c1">// èŠ‚ç‚¹è‡ªåŠ¨å‘ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;load_balancing_policy&#34;</span><span class="o">,</span> <span class="s">&#34;roundRobin&#34;</span><span class="o">);</span> <span class="c1">// è´Ÿè½½å‡è¡¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;health_check_interval&#34;</span><span class="o">,</span> <span class="s">&#34;1000&#34;</span><span class="o">);</span> <span class="c1">// å¥åº·æ£€æŸ¥é—´éš”(ä»¥æ¯«ç§’ä¸ºå•ä½)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;health_check_query&#34;</span><span class="o">,</span> <span class="s">&#34;select 1&#34;</span><span class="o">);</span> <span class="c1">// å¥åº·æ£€æŸ¥è¯­å¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;node_check_interval&#34;</span><span class="o">,</span> <span class="s">&#34;1000&#34;</span><span class="o">);</span> <span class="c1">// èŠ‚ç‚¹æ£€æŸ¥é—´éš”(ä»¥æ¯«ç§’ä¸ºå•ä½)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;failover&#34;</span><span class="o">,</span> <span class="s">&#34;2&#34;</span><span class="o">);</span> <span class="c1">// å‘ç”Ÿæ•…éšœè½¬ç§»æœ€å¤§æ¬¡æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">properties</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">&#34;retry&#34;</span><span class="o">,</span> <span class="s">&#34;2&#34;</span><span class="o">);</span> <span class="c1">// æ•…éšœé‡è¯•æœ€å¤§æ¬¡æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">        <span class="c1">// å®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡çš„æ–¹å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">String</span> <span class="n">url</span> <span class="o">=</span> <span class="s">&#34;jdbc:clickhouse://h1:p1,h2:p2,h3:p3,h4:p4/default?socket_timeout=6000000&#34;</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">ClickHouseDataSource</span> <span class="n">dataSource</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ClickHouseDataSource</span><span class="o">(</span><span class="n">url</span><span class="o">,</span> <span class="n">properties</span><span class="o">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>å®è·µï¼š</p>
</blockquote>
<ul>
<li>
<p>å‡ºç° <code>The target server failed to respond code: 1002</code> æŠ¥é”™</p>
<ul>
<li><a href="https://github.com/ClickHouse/clickhouse-java/pull/760">Validate stale connection to fix the bug: failed to respond</a><code>å¢åŠ æ´»è·ƒè¿æ¥æ ¡éªŒé€»è¾‘ï¼Œé™ä½å®¢æˆ·ç«¯è·å–åˆ°å…³é—­è¿æ¥çš„æ¦‚ç‡</code></li>
<li><a href="https://github.com/ClickHouse/clickhouse-java/issues/1444">BatchUpdateException during inserts with jdbc driver</a> <code>é©±åŠ¨ä½œè€…è®¤ä¸ºï¼š å…³é”®ç‚¹åœ¨äºè¾¹ç•Œå€¼ï¼Œå¦‚æœå®¢æˆ·ç«¯è®¾ç½®çš„å’ŒæœåŠ¡ç«¯ä¸€æ ·æˆ–è€…æ›´å¤§ï¼Œå°±ä¼šå‡ºç°å®¢æˆ·ç«¯è®¤ä¸ºè¿æ¥æœªè¶…æ—¶å¯å¤ç”¨ï¼Œä½†æ˜¯æœåŠ¡ç«¯è®¤ä¸ºè¶…æ—¶äºæ˜¯å°±å…³é—­äº†è¿æ¥</code></li>
<li>JDBC URLä¼˜åŒ– socketTimeoutå‚æ•° ï¼ˆck0.6.0é»˜è®¤æ˜¯30sï¼‰, <strong>åº”æ˜æ˜¾å°äºæœåŠ¡ç«¯</strong>çš„ tcp_keep_alive_timeout ï¼ˆmsï¼‰å€¼ï¼Œ <code>select * from system.settings where name like '%keep%';</code></li>
<li>JDBC é©±åŠ¨ç‰ˆæœ¬ä½ï¼Œ ä»0.2.4 å‡çº§åˆ°0.6.0åé—®é¢˜å‡ºç°æ¦‚ç‡å°å¾ˆå¤š å› ä¸º <a href="https://github.com/ClickHouse/clickhouse-java/issues/452">host failed to respond</a> 0.2.5 ä¸»åŠ¨è·å–äº†æœåŠ¡ç«¯è®¾ç½®å€¼</li>
<li>æ³¨æ„socketTimeoutå‚æ•°åŒæ ·ä½œç”¨äºæŸ¥è¯¢æ—¶é—´ï¼Œå¦‚æœSQLæ‰§è¡Œæ—¶é—´å¤§äºè¯¥å€¼ä¼šæŠ¥é”™ read timeout <a href="https://github.com/ClickHouse/clickhouse-java/issues/159">http read timeout 30</a></li>
</ul>
</li>
<li>
<p><a href="https://github.com/ClickHouse/ClickHouse/blob/master/src/Common/ErrorCodes.cpp">é©±åŠ¨å†…é”™è¯¯ç å®šä¹‰</a></p>
<ul>
<li>æ³¨æ„CKé©±åŠ¨ä»0.3å·¦å³å¼€å§‹ï¼ŒClickHouseExceptionä¸ç»§æ‰¿SQLException</li>
</ul>
</li>
</ul>
<hr>
<h1 id="explain">Explain</h1>
<blockquote>
<p><a href="https://clickhouse.com/docs/en/sql-reference/statements/explain">Clickhouse: Explain</a><br>
<a href="https://medium.com/datadenys/using-explain-to-analyze-and-improve-clickhouse-queries-performance-23dbcdf55a97">Using Explain to analyze and improve Clickhouse queries performance</a></p>
</blockquote>
<p>ç›¸æ¯”äºMySQLçš„Explainï¼ŒCKè®¾è®¡Explainèƒ½æŸ¥çœ‹æ›´å¤šç»´åº¦çš„æŒ‡æ ‡</p>
<p>JSONæ ¼å¼æŸ¥çœ‹ <code>EXPLAIN json = 1, indexes = 1 SQL</code></p>
<ul>
<li>å…³æ³¨æœ€å†…å±‚çš„Indexesç»“æ„é‡Œçš„ <strong>Initial Parts</strong> å…¨éƒ¨å— <strong>Selected Parts</strong> è¯»å–çš„å— <strong>Initial Granules</strong> å…¨éƒ¨ç²’åº¦ <strong>Selected Granules</strong> è¯»å–çš„ç²’åº¦ã€‚</li>
<li>è¯»å–çš„æŒ‡æ ‡è¶Šå°è¶Šå¥½ï¼Œå› æ­¤è¡¨è¦åŸºäºä½¿ç”¨æƒ…å†µè®¾è®¡å¥½åˆ†åŒºåˆ©äºæŸ¥è¯¢æ•ˆç‡</li>
</ul>
<hr>
<h1 id="tips">Tips</h1>
<ul>
<li>
<p>åˆç†ä½¿ç”¨æ’åºé”®è®©æ•°æ®å‡åŒ€åˆ†ç‰‡ï¼Œé¿å…æ•°æ®å€¾æ–œå¯¼è‡´é›†ç¾¤è®¡ç®—æ—¶å‡ºç°çŸ­æ¿æ•ˆåº”</p>
</li>
<li>
<p>æ•°æ®å¤§é‡æŸ¥è¯¢å¯¼å…¥å¯¼å‡ºæ—¶</p>
<ul>
<li><a href="https://cloud.tencent.com/developer/article/1979184">ClickHouse SQLåŸºæœ¬è¯­æ³•å’Œå¯¼å…¥å¯¼å‡ºå®æˆ˜</a></li>
<li>å¯¼å‡ºæ—¶éœ€è¦æ³¨æ„ä¼ ç»Ÿçš„ limit offset ä¼šå¯¼è‡´ç»“æœé›† é‡å¤å’Œä¸¢å¤±ï¼Œè¿½åŠ  order by å­å¥å¯ä»¥é™ä½å‘ç”Ÿæ¦‚ç‡ï¼Œä½†æ˜¯æ’åºå­—æ®µä¸å”¯ä¸€çš„è¯è¿˜æ˜¯ä¼šæœ‰å¯èƒ½å‡ºç°é‡å¤æˆ–ä¸¢å¤±çš„é—®é¢˜ã€‚</li>
</ul>
</li>
<li>
<p>å¤šè¡¨å…³è” å¦‚æœèƒ½ç¡®è®¤èŒƒå›´è¿‡æ»¤çš„æ•°æ®åªä¼šä»ä¸€ä¸ªè¡¨è¿”å›å¯ä»¥é¿å…joinæ¥è¿‡æ»¤, è½¬ç”¨in, é¿å…åˆ†å¸ƒå¼çš„åšæ•°æ®å¤åˆ¶ï¼Œå¯¼è‡´èµ„æºæ¶ˆè€—æ”¾å¤§</p>
</li>
<li>
<p>Global ä¼˜åŒ– join å’Œin é¿å…è¯»æ”¾å¤§</p>
</li>
</ul>
<blockquote>
<p>BUG</p>
</blockquote>
<ul>
<li><a href="https://github.com/ClickHouse/ClickHouse/releases/tag/v22.3.5.5-lts">22.3.5.5</a>ç‰ˆæœ¬ä¸Š ä½¿ç”¨ UNION ALL è¿æ¥ A å’Œ Bä¸¤æ®µSQLæ—¶ï¼ŒCKå¶ç°å‡ºç°Bæ®µSQLæ²¡æœ‰æ­£ç¡®çš„groupbyèšåˆï¼ˆæœ‰äº›æ•°æ®æ²¡æœ‰èšåˆï¼‰ï¼Œå¯¼è‡´æ•´ä½“æ‰§è¡Œç»“æœæ¡ç›®æ•°å˜å¤šï¼ŒéæœŸæœ›æ•°æ®</li>
</ul>

    </div>

    <div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">æ–‡ç« ä½œè€…</span>
    <span class="item-content">Kuangcp</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">ä¸Šæ¬¡æ›´æ–°</span>
    <span class="item-content">
        2023-03-31
        
    </span>
  </p>
  
  
</div>
<footer class="post-footer">
      
      <nav class="post-nav">
        <a class="prev" href="/post/skills/network/security/">
            <i class="iconfont icon-left"></i>
            <span class="prev-text nav-default">ç½‘ç»œå®‰å…¨</span>
            <span class="prev-text nav-mobile">ä¸Šä¸€ç¯‡</span>
          </a>
        <a class="next" href="/post/skills/test/benchmark/">
            <span class="next-text nav-default">åŸºå‡†æµ‹è¯•</span>
            <span class="next-text nav-mobile">ä¸‹ä¸€ç¯‡</span>
            <i class="iconfont icon-right"></i>
          </a>
      </nav>
    </footer>
  </article>
        </div>
        

  

  

      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
      <a href="https://github.com/Kuangcp" class="iconfont icon-github" title="github"></a>
  <a href="https://www.kuangcp.top/index.xml" type="application/rss+xml" class="iconfont icon-rss" title="rss"></a>
</div>

<div class="copyright">
  <span class="power-by">
    ç”± <a class="hexo-link" href="https://gohugo.io">Hugo</a> å¼ºåŠ›é©±åŠ¨
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    ä¸»é¢˜ - 
    <a class="theme-link" href="https://gitee.com/gin9/hugo-theme-even">Even</a>
  </span>

  

  <span class="copyright-year">
    &copy; 
    2017 - 
    2024<span class="heart"><i class="iconfont icon-heart"></i></span>
    <span>Kuangcp</span>
    
    <br/><span><a href='http://beian.miit.gov.cn/'; target=_blank>www.kuangcp.top</a></span>
  </span>
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont icon-up"></i>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js" integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js" integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.min.js" integrity="sha256-jwCP0NAdCBloaIWTWHmW4i3snUNMHUNO+jr9rYd2iOI=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/timeago.js@3.0.2/dist/timeago.locales.min.js" integrity="sha256-ZwofwC1Lf/faQCzN7nZtfijVV6hSwxjQMwXL4gn9qU8=" crossorigin="anonymous"></script>
  <script><!-- NOTE: timeago.js uses the language code format like "zh_CN" (underscore and case sensitive) -->
    var languageCode = "zh-cn".replace(/-/g, '_').replace(/_(.*)/, function ($0, $1) {return $0.replace($1, $1.toUpperCase());});
    timeago().render(document.querySelectorAll('.timeago'), languageCode);
    timeago.cancel();  
  </script>



<script type="text/javascript" src="/js/main.min.64437849d125a2d603b3e71d6de5225d641a32d17168a58106e0b61852079683.js"></script>






</body>
</html>
